var config = require('uiconfig');
var Base = require('ampersand-collection');
var lodashMixin = require('ampersand-collection-lodash-mixin');
var restMixin = require('ampersand-collection-rest-mixin');
var urlRe = require('url-regex')({ exact: true });
var debug = require('debug')("craftodex:base:collection");
var _ = require('lodash');

var registry = require('registry');

module.exports = Base.extend(
  lodashMixin,
  restMixin,
  {
    url: config.api,
  },
  {
    set: function (models, options) {
      debug("set", models, options);

      models = !_.isArray(models) ?
        (models ? [models] : []) : models.slice();

      models = models.map(function (model) {
        // if is url link, get from registry
        if (urlRe.test(model)) {
          return registry.get(model);
        }
        return model;
      });

      debug("calling base set", models, options);
      return Base.prototype.set.call(this, models, options);
    }
  }
);
